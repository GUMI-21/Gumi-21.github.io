<!DOCTYPE html>

<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <!--
        hexo-theme-suka © SukkaW
        GitHub: https://github.com/SukkaW/hexo-theme-suka
    -->

    <!-- ### Resource Hint ### -->

    <!-- ## DNS Prefetch ## -->
    <meta http-equiv="x-dns-prefetch-control" content="on">

<!-- busuanzi -->

    <link rel="dns-prefetch" href="//busuanzi.ibruce.info">


<!-- comment -->







<!-- analytics -->







    <!-- ## Preload ## -->
    
    <!-- Busuanzi -->
    
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" as="script">







    <!-- ### Meta & Title & Info ### -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, maximum-scale=5, viewport-fit=cover">
    <meta name="renderer" content="webkit">

    <!-- Title -->
    <title>Groutine、检测并修正竞争状态、通道 | Gumi-Termainl</title>

    <!-- Favicons -->
    <link rel="icon" type="image&#x2F;ico" href="/source/img/bitbug_favicon.ico"><link rel="icon" typt="image&#x2F;png" sizes="32x32" href="/source/img/211215.png">

    <!-- ### Import File ### -->
    <link rel="stylesheet" href="/lib/spectre/spectre.min.css"><style>
    body {
        background-color: #f8f9fa;
    }

    a, a:visited {
        color: #0070ff;
    }

    a:active, a:focus, a:hover {
        color: #0070ff;
        opacity: .75;
    }

    #post-content a,
    #post-content a:hover,
    #post-content a:focus,
    #post-content a:visited {
        color: #005eb9;
        opacity: 1;
    }

    

    .post-entry .card-body a {
        color: #0070ff;
    }

    .avatar {
        background: #444;
    }

    .navbar-link,
    .navbar-link:visited,
    .timeline .timeline-item .timeline-icon.icon-lg {
        color: #0070ff;
    }

    .navbar-link:hover {
        color: #0070ff;
        opacity: .8;
    }

    #search-input .btn,
    #disqus_click_btn,
    #disqus-switch-to-direct,
    #disqus-loadmore-button {
        background: #727e96;
        border-color: #727e96;
        color: #fff;
    }

    #post-toc a.post-toc-link,
    #post-toc a.post-toc-link:visited,
    .share-menu.menu .menu-item>a {
        color: #727e96;
    }

    .share-menu.menu .menu-item>a:hover,
    .share-menu.menu .menu-item>a:focus,
    .share-menu.menu .menu-item>a:visited {
        color: #50596c;
        background: #f8f9fa;
        opacity: .85;
    }
</style><link rel="stylesheet" href="/css/style.min.css">








    <!-- Prettify Theme -->
    
    <link rel="preload" href="/css/highlight/github.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="/css/highlight/github.min.css"></noscript>





<script>
/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
!function(t){"use strict";t.loadCSS||(t.loadCSS=function(){});var e=loadCSS.relpreload={};if(e.support=function(){var e;try{e=t.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),e.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},e.poly=function(){if(!e.support())for(var a=t.document.getElementsByTagName("link"),n=0;n<a.length;n++){var o=a[n];"preload"!==o.rel||"style"!==o.getAttribute("as")||o.getAttribute("data-loadcss")||(o.setAttribute("data-loadcss",!0),e.bindMediaToggle(o))}},!e.support()){e.poly();var a=t.setInterval(e.poly,500);t.addEventListener?t.addEventListener("load",function(){e.poly(),t.clearInterval(a)}):t.attachEvent&&t.attachEvent("onload",function(){e.poly(),t.clearInterval(a)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:t.loadCSS=loadCSS}("undefined"!=typeof global?global:this);
</script>

    <!-- ### Site Verification ### -->
    


    <meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="Gumi-Termainl"><meta name="msapplication-starturl" content="http://example.com"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Gumi-Termainl"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- ### The Open Graph & Twitter Card Protocol ### -->
    <meta property="og:title" content="Groutine、检测并修正竞争状态、通道 | Gumi-Termainl"><meta property="og:site_name" content="Gumi-Termainl"><meta property="og:type" content="article"><meta property="og:url" content="http://example.com/2022/03/19/Groutine%E3%80%81%E6%A3%80%E6%B5%8B%E5%B9%B6%E4%BF%AE%E6%AD%A3%E7%AB%9E%E4%BA%89%E7%8A%B6%E6%80%81%E3%80%81%E9%80%9A%E9%81%93/"><meta property="og:locale" content="zh-CN"><meta name="description" content="关于如何使用groutine运行程序、检测并修正竞争状态、利用通道共享数据。参考至《GO语言实战》第六章内容   使用groutine运行程序** 检测并修正竞争状态 利用通道共享数据 当一个函数创建为 goroutine时，Go 会将其视为一个独立的工作单元。  并发与并行  当运行一个应用程序（如一个 IDE 或者编辑器）的时候，操作系统会为这个应用程序启动一个进程。可以将这个进程看作一个包含 - Gumi - Gumi-Termainl"><meta name="keywords" content="并发,Golang"><meta property="og:image" content="http://example.com/source_posts%5CGroutine%01%EF%BF%BDKv%EF%BF%BDc%DE%89%EF%BF%BD%01%01%1AS_1N(%5BW49ZXN%5B7JV%25G1LA%7BM0.png"><meta property="article:published_time" content="2022-03-19T07:46:44.000Z"><meta property="article:modified_time" content="2022-03-27T08:42:46.823Z"><meta property="og:updated_time" content="2022-03-27T08:42:46.823Z"><meta property="article:author" content="Gumi"><meta property="article:tag" content="并发,Golang"><meta name="twitter:card" content="summary">

    

    <!-- ### Canonical link ### -->
    <link rel="canonical" href="http://example.com/2022/03/19/Groutine%E3%80%81%E6%A3%80%E6%B5%8B%E5%B9%B6%E4%BF%AE%E6%AD%A3%E7%AB%9E%E4%BA%89%E7%8A%B6%E6%80%81%E3%80%81%E9%80%9A%E9%81%93/">

    <meta name="generator" content="Hexo 6.1.0">

    <!-- ### Analytics ### -->
    







    <!-- ### Structured Data ### -->
    



<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "url": "http://example.com/2022/03/19/Groutine%E3%80%81%E6%A3%80%E6%B5%8B%E5%B9%B6%E4%BF%AE%E6%AD%A3%E7%AB%9E%E4%BA%89%E7%8A%B6%E6%80%81%E3%80%81%E9%80%9A%E9%81%93/",
    "@type": "BlogPosting",
    "logo": "http://example.com/source/img/211215.png",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://example.com/2022/03/19/Groutine%E3%80%81%E6%A3%80%E6%B5%8B%E5%B9%B6%E4%BF%AE%E6%AD%A3%E7%AB%9E%E4%BA%89%E7%8A%B6%E6%80%81%E3%80%81%E9%80%9A%E9%81%93/"
    },
    "headline": "Groutine、检测并修正竞争状态、通道 | Gumi-Termainl",
    
    "image": {
        "@type": "ImageObject",
        "url": "http://example.com/source/img/211215.png"
    },
    
    "datePublished": "2022-03-19T07:46:44.000Z",
    "dateModified": "2022-03-27T08:42:46.823Z",
    "author": {
        "@type": "Person",
        "name": "Gumi",
        "image": {
            "@type": "ImageObject",
            "url": "http://example.com/img/CM]O~9@4EFL88E~%60W~EB21H.png"
        },
        "description": "夜风拂过,暗夜飘摇,轻奏音色,飘舞静寂."
    },
    "publisher": {
        "@type": "Organization",
        "name": "Gumi-Termainl",
        "logo": {
            "@type": "ImageObject",
            "url": "http://example.com/source/img/211215.png"
        }
    },
    
    "potentialAction": {
        "@type": "SearchAction",
        "target": "http://example.com/search?s={search_term_string}",
        "query-input": "required name=search_term_string"
    },
    
    "keywords": "并发,Golang",
    "description": "关于如何使用groutine运行程序、检测并修正竞争状态、利用通道共享数据。参考至《GO语言实战》第六章内容   使用groutine运行程序** 检测并修正竞争状态 利用通道共享数据 当一个函数创建为 goroutine时，Go 会将其视为一个独立的工作单元。  并发与并行  当运行一个应用程序（如一个 IDE 或者编辑器）的时候，操作系统会为这个应用程序启动一个进程。可以将这个进程看作一个包含 - Gumi - Gumi-Termainl"
}
</script>



    <!-- ### Custom Head ### -->
    
</head>

    <body>
            

            <!-- ### Main content ### -->
            <!-- ## Header ##-->
<header>
    <h1 class="header-title text-center"><a href="/">Gumi-Termainl</a></h1>

    <p class="text-center header-slogan">
        
            
                夜风拂过,暗夜飘摇,轻奏音色,飘舞静寂.
            
        
    </p>

    <nav class="navbar-section text-center">
    
        <a href="/" class="navbar-link">首页</a>
    
    
        <a href="/archives/" class="navbar-link">归档</a>
    
    
        <a href="/search" class="navbar-link">搜索</a>
    
    
    
        <div class="dropdown dropdown-right">
    <a class="navbar-link dropdown-toggle" tabindex="0">分享</a>
    <ul class="menu share-menu">

        <!-- Share Weibo -->
        
        <li class="menu-item">
            <a href="http://service.weibo.com/share/share.php?appkey=&title=Gumi-Termainl&url=http://example.com&pic=http://example.com/source/img/211215.png&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">分享到微博</a>
        </li>
        

        <!-- Share Twitter -->
        
        <li class="menu-item">
            <a href="https://twitter.com/intent/tweet?text=Gumi-Termainl&url=http://example.com&via=Gumi" target="_blank" rel="external noopener noreferrer nofollow">分享到 Twitter</a>
        </li>
        

        <!-- Share Facebook -->
        
        <li class="menu-item">
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://example.com" target="_blank" rel="external noopener noreferrer nofollow">分享到 Facebook</a>
        </li>
        

        <!-- Share Google+ -->
        
        <li class="menu-item">
            <a href="https://plus.google.com/share?url=http://example.com" target="_blank" rel="external noopener noreferrer nofollow">分享到 Google+</a>
        </li>
        

        <!-- Share LinkedIn -->
        
        <li class="menu-item">
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://example.com&title=Groutine、检测并修正竞争状态、通道" target="_blank" rel="external noopener noreferrer nofollow">分享到 LinkedIn</a>
        </li>
        

        <!-- Share QQ -->
        
        <li class="menu-item">
            <a href="http://connect.qq.com/widget/shareqq/index.html?site=Gumi-Termainl&title=Groutine、检测并修正竞争状态、通道&summary=Gumi的小屋&pics=http://example.com/source/img/211215.png&url=http://example.com" target="_blank" rel="external noopener noreferrer nofollow"> 分享到 QQ</a>
        </li>
        

        <!-- Share Telegram -->
        
        <li class="menu-item">
            <a href="https://t.me/share/url?url=http://example.com&text=Groutine、检测并修正竞争状态、通道" target="_blank" rel="external noopener noreferrer nofollow">分享到 Telegram</a>
        </li>
        

        <!-- QRCode -->
        
        <li class="menu-item">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOQAAADkCAAAAACtPNdRAAAEIklEQVR42u3aS27cQBAEUd3/0vbKgCCLlZFNLVhUzEb2jIfuR0DF+n38+QWvD5EiRYoUKfIm8mN4fff5v/e++/7n977+JNf7fI3/Dvzls3RukSI3I6eLXh306382HWC69nRTv7smPbdIkduRU3CZkNN303snwaY5t0iRb0ReHSjdlKtD0+RhQokU+ZuRU/A5faWkmwQokSLfjhwT3YskOhWw6YHe3rjpOreqEJEiH4Ykh3zizx/t1okU+RAkTarJ5/SB3zTBUgD6kamWSJEPQqahzFTETo2qFCBScys1sqemlkiRb0JeJeLNECYV3LTxTIc9R50BkSIfiqSBhS4ppCQ6NaLuDGv/O5dIkQuR7QJCc6h0WJL80wFQ1a0TKfLByOnhfWfJ8E6ASX8mw1iRIjcjyUP9NImnAS41yJpBj0iRm5FkoEoxqSnWLCk1w1g81RIpcgEyNZaaJIEsWKQbQotusrQoUuRGJB2CksWlZrE3PfQRIiQLIkVuRDYJc/PgpodON4u+/21gEilyKbK5SHqIp2ZWagyTf5sSfpEiNyNpEyoFlNRsIkkDHQKRRSWRIjcj6XA0LeiSQczdm5oWmsZunUiRS5CXv7jDxWkSnhpcZAG4WQauo6tIkQ9DTsBm4ahJFtJgqSkKqqJZpMgFSDLoaYtqmkRPg92maL68hkiRS5Ftsn46pCUNqJMbipaVRIpcgiRJOgkY7ZIvGdSSQnsssEWKXIhshzNkkY8OeUgjqymcUTIgUuQCJP3FJk2pkwUkWhDQglykyM1I2qRKB0vDV9q0osENJfsiRS5ENsVsWuxLCQRdDjxJ1FF0FSlyCZIm4qQZnApjUnCToposN4kUuRVJCl6SfJMhK0m2p5tLljhEityMnIIBTeLTDTtdJiSD2bGRLVLkQiQZgKbGFRn8pKQgNabSTY9Fs0iRC5Fk8EMTZLRMVCwdpqIeVSEiRS5DpgWH06ZTM7ChBTcKQiJFvgiZHuo0SaB/J4PgKUG4tSUpUuSDkOkLTUOJHpQ0l5vgdukQKXIhki5FkMVdukTfBCc6cBIp8m1I2siiCfedpnAT9MaEXqTIpchpwEoezjSAtUuH9IwiRb4JOT1Yp8Q7BQLSXCbN6JMlJZEiNyObhb409ElLFbQgb4dCl5+LFLkQ2TZvSeJwkrCnm5gGxtVGlkiRD0feCRBk6NosFrYJP1q0FylyKbJZWiKJwUkjLBUEzQBXpMiNSDroaQaptNGVBj/NsDYu2osUuQhJmlcnwSAV0GlJihbO1RBWpMglSNLASo2mpsmVCuCfSNJFinwjkjaKGyS9sTS5j40skSJfikyN4iYZP1loujWEFSlyGTItEdGiNSX0acmIDmbrSbNIkYuQTSJ9FYjSwZvkml4vvidS5ELkm18iRYoUKVLk4esvEIi0gO5opBsAAAAASUVORK5CYII=" alr="QRCode">
        </li>
        

    </ul>
</div>
    
    
</nav>
</header>

            
    <!-- ## Post ## -->
    <div class="post-container">
    <div id="post-card" class="card">
        
        <div class="card-item-container">
            <div class="card-inner-cell">
                <!-- # Post Header Info # -->
                <div class="card-header">
                    
    <h1 class="card-title h3 mb-2">Groutine、检测并修正竞争状态、通道</h1>




<div class="post-header-info">
    <p class="post-header-info-left text-gray">
        <img class="author-thumb lazyload" data-src="/img/CM%5DO~9@4EFL88E~%60W~EB21H.png" src="/img/suka-lazyload.gif" alt="Gumi's Avatar">
        <span>2022-03-19</span>
        
        
            <!-- Busuanzi Post Views -->
<span id="busuanzi_container_page_pv" hidden>
    <span class="suka-devide-dot"></span>
    <span></span>
    <span id="busuanzi_value_page_pv"></span>
    <span>Views</span>
</span>
        
        
    </p>
    <div class="post-header-info-right">
        
            <div class="dropdown dropdown-right">
<a class="dropdown-toggle" tabindex="0">分享本文</a>
<ul class="menu share-menu">
    <!-- Share Weibo -->
    
    <li class="menu-item">
        <a href="http://service.weibo.com/share/share.php?appkey=&title=Groutine、检测并修正竞争状态、通道&url=http://example.com/2022/03/19/Groutine%E3%80%81%E6%A3%80%E6%B5%8B%E5%B9%B6%E4%BF%AE%E6%AD%A3%E7%AB%9E%E4%BA%89%E7%8A%B6%E6%80%81%E3%80%81%E9%80%9A%E9%81%93/&pic=http://example.com/source/img/211215.png&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">分享到微博</a>
    </li>
    

    <!-- Share Twitter -->
    
    <li class="menu-item">
        <a href="https://twitter.com/intent/tweet?text=Groutine、检测并修正竞争状态、通道&url=http://example.com/2022/03/19/Groutine%E3%80%81%E6%A3%80%E6%B5%8B%E5%B9%B6%E4%BF%AE%E6%AD%A3%E7%AB%9E%E4%BA%89%E7%8A%B6%E6%80%81%E3%80%81%E9%80%9A%E9%81%93/&via=Gumi" target="_blank" rel="external noopener noreferrer nofollow">分享到 Twitter</a>
    </li>
    

    <!-- Share Facebook -->
    
    <li class="menu-item">
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://example.com/2022/03/19/Groutine%E3%80%81%E6%A3%80%E6%B5%8B%E5%B9%B6%E4%BF%AE%E6%AD%A3%E7%AB%9E%E4%BA%89%E7%8A%B6%E6%80%81%E3%80%81%E9%80%9A%E9%81%93/" target="_blank" rel="external noopener noreferrer nofollow">分享到 Facebook</a>
    </li>
    

    <!-- Share Google+ -->
    
    <li class="menu-item">
        <a href="https://plus.google.com/share?url=http://example.com/2022/03/19/Groutine%E3%80%81%E6%A3%80%E6%B5%8B%E5%B9%B6%E4%BF%AE%E6%AD%A3%E7%AB%9E%E4%BA%89%E7%8A%B6%E6%80%81%E3%80%81%E9%80%9A%E9%81%93/" target="_blank" rel="external noopener noreferrer nofollow">分享到 Google+</a>
    </li>
    

    <!-- Share LinkedIn -->
    
    <li class="menu-item">
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://example.com/2022/03/19/Groutine%E3%80%81%E6%A3%80%E6%B5%8B%E5%B9%B6%E4%BF%AE%E6%AD%A3%E7%AB%9E%E4%BA%89%E7%8A%B6%E6%80%81%E3%80%81%E9%80%9A%E9%81%93/&title=Gumi-Termainl" target="_blank" rel="external noopener noreferrer nofollow">分享到 LinkedIn</a>
    </li>
    

    <!-- Share QQ -->
    
    <li class="menu-item">
        <a href="http://connect.qq.com/widget/shareqq/index.html?site=Gumi-Termainl&title=Gumi-Termainl&summary=Gumi的小屋&pics=http://example.com/source/img/211215.png&url=http://example.com/2022/03/19/Groutine%E3%80%81%E6%A3%80%E6%B5%8B%E5%B9%B6%E4%BF%AE%E6%AD%A3%E7%AB%9E%E4%BA%89%E7%8A%B6%E6%80%81%E3%80%81%E9%80%9A%E9%81%93/" target="_blank" rel="external noopener noreferrer nofollow"> 分享到 QQ</a>
    </li>
    

    <!-- Share Telegram -->
    
    <li class="menu-item">
        <a href="https://t.me/share/url?url=http://example.com/2022/03/19/Groutine%E3%80%81%E6%A3%80%E6%B5%8B%E5%B9%B6%E4%BF%AE%E6%AD%A3%E7%AB%9E%E4%BA%89%E7%8A%B6%E6%80%81%E3%80%81%E9%80%9A%E9%81%93/&text=Gumi-Termainl" target="_blank" rel="external noopener noreferrer nofollow">分享到 Telegram</a>
    </li>
    

    <!-- QRCode -->
    
    <li class="menu-item">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOQAAADkCAAAAACtPNdRAAAEIklEQVR42u3aS27cQBAEUd3/0vbKgCCLlZFNLVhUzEb2jIfuR0DF+n38+QWvD5EiRYoUKfIm8mN4fff5v/e++/7n977+JNf7fI3/Dvzls3RukSI3I6eLXh306382HWC69nRTv7smPbdIkduRU3CZkNN303snwaY5t0iRb0ReHSjdlKtD0+RhQokU+ZuRU/A5faWkmwQokSLfjhwT3YskOhWw6YHe3rjpOreqEJEiH4Ykh3zizx/t1okU+RAkTarJ5/SB3zTBUgD6kamWSJEPQqahzFTETo2qFCBScys1sqemlkiRb0JeJeLNECYV3LTxTIc9R50BkSIfiqSBhS4ppCQ6NaLuDGv/O5dIkQuR7QJCc6h0WJL80wFQ1a0TKfLByOnhfWfJ8E6ASX8mw1iRIjcjyUP9NImnAS41yJpBj0iRm5FkoEoxqSnWLCk1w1g81RIpcgEyNZaaJIEsWKQbQotusrQoUuRGJB2CksWlZrE3PfQRIiQLIkVuRDYJc/PgpodON4u+/21gEilyKbK5SHqIp2ZWagyTf5sSfpEiNyNpEyoFlNRsIkkDHQKRRSWRIjcj6XA0LeiSQczdm5oWmsZunUiRS5CXv7jDxWkSnhpcZAG4WQauo6tIkQ9DTsBm4ahJFtJgqSkKqqJZpMgFSDLoaYtqmkRPg92maL68hkiRS5Ftsn46pCUNqJMbipaVRIpcgiRJOgkY7ZIvGdSSQnsssEWKXIhshzNkkY8OeUgjqymcUTIgUuQCJP3FJk2pkwUkWhDQglykyM1I2qRKB0vDV9q0osENJfsiRS5ENsVsWuxLCQRdDjxJ1FF0FSlyCZIm4qQZnApjUnCToposN4kUuRVJCl6SfJMhK0m2p5tLljhEityMnIIBTeLTDTtdJiSD2bGRLVLkQiQZgKbGFRn8pKQgNabSTY9Fs0iRC5Fk8EMTZLRMVCwdpqIeVSEiRS5DpgWH06ZTM7ChBTcKQiJFvgiZHuo0SaB/J4PgKUG4tSUpUuSDkOkLTUOJHpQ0l5vgdukQKXIhki5FkMVdukTfBCc6cBIp8m1I2siiCfedpnAT9MaEXqTIpchpwEoezjSAtUuH9IwiRb4JOT1Yp8Q7BQLSXCbN6JMlJZEiNyObhb409ElLFbQgb4dCl5+LFLkQ2TZvSeJwkrCnm5gGxtVGlkiRD0feCRBk6NosFrYJP1q0FylyKbJZWiKJwUkjLBUEzQBXpMiNSDroaQaptNGVBj/NsDYu2osUuQhJmlcnwSAV0GlJihbO1RBWpMglSNLASo2mpsmVCuCfSNJFinwjkjaKGyS9sTS5j40skSJfikyN4iYZP1loujWEFSlyGTItEdGiNSX0acmIDmbrSbNIkYuQTSJ9FYjSwZvkml4vvidS5ELkm18iRYoUKVLk4esvEIi0gO5opBsAAAAASUVORK5CYII=" alt="QRCode">
    </li>
    

</ul>
</div>
        
    </div>
</div>
                </div>
                <div class="card-body">
                    
                        
                        
                    
                    <article id="post-content">
                        <p>关于如何使用<strong>groutine运行程序</strong>、<strong>检测并修正竞争状态</strong>、<strong>利用通道共享数据</strong>。参考至《GO语言实战》第六章内容</p>
<!-- main -->

<p>使用groutine运行程序**</p>
<p><strong>检测并修正竞争状态</strong></p>
<p><strong>利用通道共享数据</strong></p>
<p>当一个函数创建为 goroutine时，Go 会将其视为一个独立的工作单元。</p>
<ul>
<li>并发与并行</li>
</ul>
<p>当运行一个应用程序（如一个 IDE 或者编辑器）的时候，操作系统会为这个应用程序启动一个进程。可以将这个进程看作一个包含了应用程序在运行中需要用到和维护的各种资源的容器。</p>
<p>一个线程是一个执行空间，这个空间会被操作系统调度来运行函数中所写的代码。</p>
<p><img src="/source_posts%5CGroutine%01%EF%BF%BDKv%EF%BF%BDc%DE%89%EF%BF%BD%01%01%1AS_1N(%5BW49ZXN%5B7JV%25G1LA%7BM0.png"></p>
<p>并发（concurrency）不是并行（parallelism）。并行是让不同的代码片段同时在不同的物理处理器上执行。</p>
<p>并行的关键是同时做很多事情，而并发是指同时管理很多事情，这些事情可能只做了一半就被暂停去做别的事情了。</p>
<ul>
<li>gouroutine</li>
</ul>
<p>一个正运行的 goroutine 在工作结束前，可以被停止并重新调度。</p>
<p>调度器这样做的目的是防止某个 goroutine 长时间占用逻辑处理器。当 goroutine 占用时间过长时，调度器会停止当前正运行的 goroutine，并给其他可运行的 goroutine 运行的机会。</p>
<p>和其他函数调用一样，创建为 goroutine 的函数调用时可以传入参数。不过 goroutine 终止时无法获取函数的返回值。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;runtime&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//这个示例程序战士goroutine调度器是如何在单个线程上切分时间片的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//wg是用来等待程序完成的</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="comment">//main</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//分配一个逻辑处理器给调度器使用</span></span><br><span class="line">	runtime.GOMAXPROCS(<span class="number">1</span>)</span><br><span class="line">	<span class="comment">//计数加2，表示要等待两个goroutine</span></span><br><span class="line">	wg.Add(<span class="number">2</span>)</span><br><span class="line">	<span class="comment">//创建两个goroutine</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;Create Groutines&quot;</span>)</span><br><span class="line">	<span class="keyword">go</span> printPrime(<span class="string">&quot;A&quot;</span>)</span><br><span class="line">	<span class="keyword">go</span> printPrime(<span class="string">&quot;B&quot;</span>)</span><br><span class="line">	<span class="comment">//等待goroutine结束</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;Waiting To Finish&quot;</span>)</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(<span class="string">&quot;Terminating Program&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printPrime</span><span class="params">(prefix <span class="type">string</span>)</span></span>&#123;</span><br><span class="line">	<span class="comment">// 在函数退出时调用Done来通知main函数工作已经完成</span></span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">next:</span><br><span class="line">	<span class="keyword">for</span> outer:=<span class="number">2</span>;outer&lt;<span class="number">5000</span>;outer++ &#123;</span><br><span class="line">		<span class="keyword">for</span> inner:=<span class="number">2</span>;inner &lt; outer;inner++&#123;</span><br><span class="line">			<span class="keyword">if</span> outer%inner==<span class="number">0</span>&#123;</span><br><span class="line">				<span class="keyword">continue</span> next</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;%s:%d\n&quot;</span>,prefix,outer)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Completed&quot;</span>,prefix)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>记住，只有在有多个逻辑处理器且可以同时让每个goroutine 运行在一个可用的物理处理器上的时候，goroutine 才会并行运行。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">runtime.GOMAXPROCS(<span class="number">2</span>) <span class="comment">//分配2个逻辑处理器给调度器使用</span></span><br><span class="line">runtime.GOMAXPROCS(runtime.NumCPU()) <span class="comment">//给每个可用的核心分配一个逻辑处理器</span></span><br></pre></td></tr></table></figure>

<p>写并发程序时的潜在危险，以及需要注意的事情：</p>
<ul>
<li>竞争状态</li>
</ul>
<p>如果两个或者多个groutine在没有互相同步的情况下，访问某个共享的资源，并试图同时读和写这个资源，就处于互相竞争的状态，这种情况被称为<strong>竞争状态</strong>。</p>
<p>同一时刻只能有一个goroutine对共享资源进行读和写操作。</p>
<p>Go 语言有一个特别的工具，可以在代码里检测竞争状态。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go build -race   //用竞争检测器标志来编译程序</span><br></pre></td></tr></table></figure>

<p>种修正代码、消除竞争状态的办法是，使用 Go 语言提供的锁机制，来锁住共享资源，从而保证 goroutine 的同步状态。</p>
<ul>
<li>锁住共享资源</li>
</ul>
<p>Go 语言提供了传统的同步 goroutine 的机制，就是对共享资源加锁。如果需要顺序访问一个整型变量或者一段代码，atomic 和 sync 包里的函数提供了很好的解决方案。</p>
<ul>
<li>原子函数（atomic)</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;sync/atomic&quot;</span></span><br><span class="line"><span class="comment">//安全的队counter加1</span></span><br><span class="line">atomic.Addint64(&amp;counter,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>程序使用了 atmoic 包的 AddInt64 函数。这个函数会同步整型值的加法，方法是强制同一时刻只能有一个 goroutine 运行并完成这个加法操作。</p>
<p>另外LoadInt64和StoreInt64。这两个函数提供了一种安全地读和写一个整型值的方式。</p>
<ul>
<li>互斥锁(mutex)</li>
</ul>
<p>互斥锁用于在代码上创建一个临界区，保证同一时间只有一个goroutine可以执行这个临界区代码。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sync</span><br><span class="line"><span class="keyword">var</span> mutex sync.Mutex <span class="comment">//mutex用来定义一段代码临界区</span></span><br><span class="line"></span><br><span class="line">mutex.Lock() &#123;&#125;  <span class="comment">//同一时刻只能允许一个goroutine进入这个临界区</span></span><br><span class="line">mutex.Unlock()   <span class="comment">//释放锁，允许其他正在等待的goroutine进入临界区</span></span><br></pre></td></tr></table></figure>

<p>使用大括号只是为了让临界区看起来更清晰，并不是必需的。</p>
<ul>
<li>通道☆</li>
</ul>
<p>当一个资源需要在 goroutine 之间共享时，通道在 goroutine 之间架起了一个管道，并提供了确保同步交换数据的机制。</p>
<p>声明通道时，需要指定将要被共享的数据的类型，可以通过通道共享内置类型、命名类型、结构类型和引用类型的值或者指针。</p>
<p>在Go语言中需要内置函数make来创建一个通道。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//无缓冲的整型通道</span></span><br><span class="line">unbuffered := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line"><span class="comment">//有缓冲的字符串通道</span></span><br><span class="line">bufferd := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>,<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p>想通道发送值或者指针需要用到&lt;-操作符</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//有缓冲的字符串通道</span></span><br><span class="line">buffered := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>,<span class="number">10</span>)</span><br><span class="line"><span class="comment">//通过通道发送一个字符串</span></span><br><span class="line">buffered &lt;- <span class="string">&quot;Gopher&quot;</span></span><br></pre></td></tr></table></figure>

<p>为了让另一个 goroutine 可以从该通道里接收到这个字符串，我们依旧使用&lt;-操作符，但这次是一元运算符</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从通道接收一个字符串</span></span><br><span class="line">value := &lt;-buffered</span><br></pre></td></tr></table></figure>

<ul>
<li>无缓冲的通道</li>
</ul>
<p>无缓冲的通道（unbuffered channel）是指在接收前没有能力保存任何值的通道。</p>
<p>这种类型的通道要求发送goroutine和接收goroutine同时准备好，才能完成发送和接收的操作。</p>
<p>如果没有同时准备好，goroutine就会阻塞等待。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个示例程序展示如何用无缓冲的通道来模拟2个goroutine间的网球比赛</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;math/rand&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">	rand.Seed(time.Now().UnixNano())</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//main</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//创建一个无缓冲的通道</span></span><br><span class="line">	court := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//计数加2，表示要等待两个goroutine</span></span><br><span class="line">	wg.Add(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//启动两个选手</span></span><br><span class="line">	<span class="keyword">go</span> player(<span class="string">&quot;Nadal&quot;</span>,court)</span><br><span class="line">	<span class="keyword">go</span> player(<span class="string">&quot;Djokovic&quot;</span>,court)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//发球</span></span><br><span class="line">	court &lt;- <span class="number">1</span></span><br><span class="line">	<span class="comment">//等待游戏结束</span></span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//模拟一个选手在打球</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">player</span><span class="params">(name <span class="type">string</span>,court <span class="keyword">chan</span> <span class="type">int</span>)</span></span>&#123;</span><br><span class="line">	<span class="comment">//在函数退出时调用Done来通知main函数工作已经完成</span></span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">//等待球被几打过来</span></span><br><span class="line">		ball,ok := &lt;- court</span><br><span class="line">		<span class="keyword">if</span> !ok&#123;</span><br><span class="line">			<span class="comment">//如果通道被关闭，我们就硬了</span></span><br><span class="line">			fmt.Printf(<span class="string">&quot;Player %s Won\n&quot;</span>,name)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//选随机数，然后用这个随机数判断是否丢球</span></span><br><span class="line">		n := rand.Intn(<span class="number">100</span>)</span><br><span class="line">		<span class="keyword">if</span> n%<span class="number">13</span> == <span class="number">0</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;Player %s Missed\n&quot;</span>,name)</span><br><span class="line">			<span class="comment">//关闭通道，表示我们输了</span></span><br><span class="line">			<span class="built_in">close</span>(court)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//显示击球数，并+1</span></span><br><span class="line">		fmt.Printf(<span class="string">&quot;Player %s Hit %d\n&quot;</span>,name,ball)</span><br><span class="line">		ball++</span><br><span class="line">		<span class="comment">//将球打向对手</span></span><br><span class="line">		court &lt;- ball</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Output:</span><br><span class="line">Player Djokovic Hit 1</span><br><span class="line">Player Nadal Hit 2</span><br><span class="line">Player Djokovic Hit 3</span><br><span class="line">Player Nadal Hit 4</span><br><span class="line">Player Djokovic Hit 5</span><br><span class="line">Player Nadal Hit 6</span><br><span class="line">Player Djokovic Hit 7</span><br><span class="line">Player Nadal Hit 8</span><br><span class="line">Player Djokovic Hit 9</span><br><span class="line">Player Nadal Hit 10</span><br><span class="line">Player Djokovic Hit 11</span><br><span class="line">Player Nadal Hit 12</span><br><span class="line">Player Djokovic Hit 13</span><br><span class="line">Player Nadal Hit 14</span><br><span class="line">Player Djokovic Hit 15</span><br><span class="line">Player Nadal Hit 16</span><br><span class="line">Player Djokovic Hit 17</span><br><span class="line">Player Nadal Hit 18</span><br><span class="line">Player Djokovic Missed</span><br><span class="line">Player Nadal Won</span><br></pre></td></tr></table></figure>

<ul>
<li>有缓冲的通道</li>
</ul>
<p>有缓冲的通道（buffered channel）是一种在被接收前能存储一个或者多个值的通道。</p>
<p>通道会阻塞发送和接收动作的条件也会不同。只有在通道中没有要接收的值时，接收动作才会阻塞。只有在通道没有可用缓冲区容纳被发送的值时，发送动作才会阻塞</p>
<p>无缓冲的通道保证进行发送和接收的 goroutine 会在同一时间进行数据交换；有缓冲的通道没有这种保证。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个示例程序展示如何使用有缓冲的通道和固定数目的goroutine来处理一堆工作</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span>(</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;math/rand&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//常量定义</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	numberGoroutines = <span class="number">4</span>   <span class="comment">//要使用的goroutine的数量</span></span><br><span class="line">	taskLoad = <span class="number">10</span>          <span class="comment">//要处理的工作的数量</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//wg 用来等待程序完成</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="comment">//init初始化</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//初始化随机数种子</span></span><br><span class="line">	rand.Seed(time.Now().Unix())</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//main</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//创建一个有缓存的通道来管理工作</span></span><br><span class="line">	tasks := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>,taskLoad)</span><br><span class="line">	<span class="comment">//启动goroutine来处理工作</span></span><br><span class="line">	wg.Add(numberGoroutines)</span><br><span class="line">	<span class="keyword">for</span> gr := <span class="number">1</span>; gr &lt;= numberGoroutines; gr++ &#123;</span><br><span class="line">		<span class="keyword">go</span> worker(tasks,gr)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//增加一组要完成的任务</span></span><br><span class="line">	<span class="keyword">for</span> post := <span class="number">1</span>; post &lt;= taskLoad; post++&#123;</span><br><span class="line">		tasks &lt;- fmt.Sprintf(<span class="string">&quot;Task:%d&quot;</span>,post)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//当前所有工作都处理完毕关闭通道</span></span><br><span class="line">	<span class="built_in">close</span>(tasks)</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//WORKEER作为goroutine启动来处理从有缓冲的通道传入的工作</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(tasks <span class="keyword">chan</span> <span class="type">string</span>,worker <span class="type">int</span>)</span></span>&#123;</span><br><span class="line">	<span class="comment">//通知函数已经返回</span></span><br><span class="line">	<span class="keyword">defer</span> wg.Done()</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">//等待分配工作</span></span><br><span class="line">		task,ok := &lt;- tasks</span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;Worker:%d:Shutting Down\n&quot;</span>,worker)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//显示我们要开始工作了</span></span><br><span class="line">		fmt.Printf(<span class="string">&quot;Worker:%d:Started %s\n&quot;</span>,worker,task)</span><br><span class="line">		<span class="comment">//随机等待一段时间来模拟工作</span></span><br><span class="line">		sleep := rand.Int63n(<span class="number">100</span>)</span><br><span class="line">		time.Sleep(time.Duration(sleep) * time.Millisecond)</span><br><span class="line">		<span class="comment">//显示工作完成</span></span><br><span class="line">		fmt.Printf(<span class="string">&quot;Worker: %d : Completed %s \n&quot;</span>,worker,task)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Output:</span><br><span class="line">Worker:<span class="number">4</span>:Started Task:<span class="number">4</span></span><br><span class="line">Worker:<span class="number">3</span>:Started Task:<span class="number">3</span></span><br><span class="line">Worker:<span class="number">2</span>:Started Task:<span class="number">2</span></span><br><span class="line">Worker:<span class="number">1</span>:Started Task:<span class="number">1</span></span><br><span class="line">Worker: <span class="number">1</span> : Completed Task:<span class="number">1</span> </span><br><span class="line">Worker:<span class="number">1</span>:Started Task:<span class="number">5</span></span><br><span class="line">Worker: <span class="number">2</span> : Completed Task:<span class="number">2</span> </span><br><span class="line">Worker:<span class="number">2</span>:Started Task:<span class="number">6</span></span><br><span class="line">Worker: <span class="number">4</span> : Completed Task:<span class="number">4</span> </span><br><span class="line">Worker:<span class="number">4</span>:Started Task:<span class="number">7</span></span><br><span class="line">Worker: <span class="number">1</span> : Completed Task:<span class="number">5</span> </span><br><span class="line">Worker:<span class="number">1</span>:Started Task:<span class="number">8</span></span><br><span class="line">Worker: <span class="number">3</span> : Completed Task:<span class="number">3</span> </span><br><span class="line">Worker:<span class="number">3</span>:Started Task:<span class="number">9</span></span><br><span class="line">Worker: <span class="number">4</span> : Completed Task:<span class="number">7</span> </span><br><span class="line">Worker:<span class="number">4</span>:Started Task:<span class="number">10</span></span><br><span class="line">Worker: <span class="number">3</span> : Completed Task:<span class="number">9</span> </span><br><span class="line">Worker:<span class="number">3</span>:Shutting Down</span><br><span class="line">Worker: <span class="number">2</span> : Completed Task:<span class="number">6</span> </span><br><span class="line">Worker:<span class="number">2</span>:Shutting Down</span><br><span class="line">Worker: <span class="number">4</span> : Completed Task:<span class="number">10</span> </span><br><span class="line">Worker:<span class="number">4</span>:Shutting Down</span><br><span class="line">Worker: <span class="number">1</span> : Completed Task:<span class="number">8</span> </span><br><span class="line">Worker:<span class="number">1</span>:Shutting Down</span><br></pre></td></tr></table></figure>

<p>当通道关闭后，goroutine 依旧可以从通道接收数据，但是不能再向通道里发送数据。</p>
<p>有缓冲的通道和无缓冲的通道的例子很好地展示了如何编写使用通道的代码。在下一章，我们会介绍真实世界里的一些可能会在工程里用到的并发模式。</p>
<ul>
<li>小结</li>
</ul>
<p>并发是指goroutine运行的时候是相互独立的。</p>
<p>使用关键词go创建goroutine来运行函数。</p>
<p>goroutine在逻辑处理器上执行，而逻辑处理器具有独立的系统线程和运行队列。</p>
<p>竞争状态是指两个或者多个goroutine试图访问同一个资源。</p>
<p>原子函数和互斥锁提供了一种防止出现竞争状态的办法。</p>
<p>通道提供了一种在两个goroutine之间共享数据的简单方法。</p>
<p>无缓冲的通道保证同时交换数据，而有缓冲的通道不做这种保证。</p>

                    </article>
                    


    <blockquote id="date-expire-notification" class="post-expired-notify">本文最后更新于 <span id="date-expire-num"></span> 天前，文中所描述的信息可能已发生改变</blockquote>
    <script>
    (function() {
        var dateUpdate = Date.parse("2022-03-27");
        var nowDate = new Date();
        var a = nowDate.getTime();
        var b = a - dateUpdate;
        var daysUpdateExpire = Math.floor(b/(24*3600*1000));
        if (daysUpdateExpire >= 120) {
            document.getElementById('date-expire-num').innerHTML = daysUpdateExpire;
        } else {
            document.getElementById('date-expire-notification').style.display = 'none';
        }
    })();
    </script>


<p class="post-footer-info mb-0 pt-0">本文发表于&nbsp;<time datetime="2022-03-19T07:46:44.000Z" itemprop="datePublished">2022-03-19</time>

    , 最后修改于&nbsp;<time datetime="2022-03-27T08:42:46.823Z" itemprop="dateModified">2022-03-27</time>

</p>
<p class="post-footer-info mb-0 pt-2">



<span class="post-tags-list mt-2">

<a class="post-tags-list-item" href="/tags/%E5%B9%B6%E5%8F%91-Golang/" rel="tag">#&nbsp;并发,Golang</a>

</span>


</p>

                </div>
                <div class="post-nav px-2 bg-gray">
<ul class="pagination">
    <!-- Prev Nav -->
    
        <li class="page-item page-prev">
            <a href="/2022/03/27/GO-%E6%89%80%E6%9C%89Panic%E7%9A%84%E6%83%85%E5%86%B5/" rel="prev">
                <div class="page-item-title"><i class="icon icon-back" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">GO-所有Panic的情况</div>
            </a>
        </li>
    

    <!-- Next Nav -->
    
        <li class="page-item page-next">
            <a href="/2022/03/17/%E5%B7%A5%E5%85%B7%E8%AE%B0%E5%BD%95/" rel="next">
                <div class="page-item-title"><i class="icon icon-forward" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">工具命令记录</div>
            </a>
        </li>
    
</ul>
</div>

                
                    <!-- # Comment # -->
                    
                
            </div>
        </div>
    </div>
</div>

            <!-- ### Footer ### -->
            <footer class="text-center">
    <!-- footer copyright -->
    
        <p class="footer-copyright mb-0">Copyright&nbsp;©&nbsp;<span id="copyright-year"></span>
            <a class="footer-copyright-a" href="http://example.com">Gumi-Termainl</a>
        </p>

    <!-- footer custom text -->
    <p class="footer-text mb-0">
    
    </p>
    <!-- footer develop info -->
    <p class="footer-develop mb-0">
        
    <!-- Busuanzi User Views -->
    <span id="busuanzi_container_site_uv" hidden>
        <span></span>
        <span id="busuanzi_value_site_uv"></span>
        <span>Viewers</span>
        
            <span>|</span>
        
    </span>




        
        Powered by&nbsp;<!--
         --><a href="https://hexo.io" target="_blank" class="footer-develop-a" rel="external nofollow noopener noreferrer">Hexo</a><span class="footer-develop-divider"></span>Theme&nbsp;-&nbsp;<!--
         --><a href="https://github.com/SukkaW/hexo-theme-suka" target="_blank" class="footer-develop-a" rel="external noopener">Suka</a>
    </p>
</footer>


        <!-- ### Import File ### -->
        <!-- ### Footer JS Import ### -->

<script>

    
window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 50
};
document.getElementById('copyright-year').textContent = new Date().getFullYear();
console.log('\n %c Suka Theme (hexo-theme-suka) | © SukkaW | Verision 1.3.3 %c https://github.com/SukkaW/hexo-theme-suka \n', 'color: #fff; background: #444; padding:5px 0;', 'background: #bbb; padding:5px 0;');

</script>

<script src="/lib/vanilla-lazyload/lazyload.min.js" async></script>
    <script src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" async></script>


<!-- Offset -->




<!-- Comment -->


<!-- ### Custom Footer ### -->

    </body>

</html>